<div class="attendance-list-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">
      <span class="icon">ğŸ“‹</span>
      Quáº£n LÃ½ Äiá»ƒm Danh
    </h1>
    <button class="btn btn-primary" (click)="openCreateModal()">
      <span>â•</span> Táº¡o Buá»•i Äiá»ƒm Danh
    </button>
  </div>

  <!-- Alert Messages -->
  <div *ngIf="success" class="alert alert-success">
    <span class="alert-icon">âœ“</span>
    <span>{{ success }}</span>
  </div>

  <div *ngIf="error" class="alert alert-error">
    <span class="alert-icon">âœ•</span>
    <span>{{ error }}</span>
  </div>

  <!-- Filters -->
  <div class="filters-card">
    <div class="filter-group">
      <label>MÃ´n há»c:</label>
      <select [(ngModel)]="selectedCourseId" (change)="onCourseFilterChange()" class="filter-select">
        <option value="">Táº¥t cáº£ mÃ´n há»c</option>
        <option *ngFor="let course of courses" [value]="course.courseId">
          {{ course.courseName }}
        </option>
      </select>
    </div>

    <div class="filter-group">
      <label>Tráº¡ng thÃ¡i:</label>
      <select [(ngModel)]="statusFilter" class="filter-select">
        <option value="all">Táº¥t cáº£</option>
        <option value="Scheduled">ÄÃ£ lÃªn lá»‹ch</option>
        <option value="Completed">ÄÃ£ hoÃ n thÃ nh</option>
        <option value="Cancelled">ÄÃ£ há»§y</option>
      </select>
    </div>

    <div class="filter-group">
      <label>TÃ¬m kiáº¿m:</label>
      <input type="text" [(ngModel)]="searchTerm" placeholder="TÃ¬m theo tiÃªu Ä‘á», mÃ´n há»c..." class="filter-input" />
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading && sessions.length === 0" class="loading-container">
    <div class="spinner"></div>
    <p>Äang táº£i...</p>
  </div>

  <!-- Sessions List -->
  <div *ngIf="!loading || sessions.length > 0" class="sessions-grid">
    <div *ngFor="let session of filteredSessions" class="session-card">
      <div class="session-header">
        <h3>{{ session.sessionTitle }}</h3>
        <span class="status-badge" [ngClass]="getStatusClass(session.status || '')">
          {{ getStatusLabel(session.status || '') }}
        </span>
      </div>

      <div class="session-info">
        <div class="info-row">
          <span class="icon">ğŸ“š</span>
          <span>{{ session.courseName }}</span>
        </div>
        <div class="info-row">
          <span class="icon">ğŸ“…</span>
          <span>{{ formatDate(session.sessionDate) }}</span>
        </div>
        <div class="info-row">
          <span class="icon">ğŸ•</span>
          <span>{{ formatTime(session.sessionTime) }}</span>
        </div>
        <div class="info-row" *ngIf="session.location">
          <span class="icon">ğŸ“</span>
          <span>{{ session.location }}</span>
        </div>
        <div class="info-row">
          <span class="icon">ğŸ‘¥</span>
          <span>{{ session.totalStudents || 0 }} sinh viÃªn</span>
        </div>
        <div class="info-row" *ngIf="session.status === 'Completed'">
          <span class="icon">âœ“</span>
          <span>{{ session.presentCount || 0 }} cÃ³ máº·t, {{ session.absentCount || 0 }} váº¯ng</span>
        </div>
        <div class="info-row" *ngIf="session.attendanceRate !== undefined">
          <span class="icon">ğŸ“Š</span>
          <span [style.color]="getAttendanceRateColor(session.attendanceRate)">
            Tá»· lá»‡: {{ session.attendanceRate }}%
          </span>
        </div>
      </div>

      <div class="session-actions">
        <button class="btn btn-primary btn-sm" (click)="viewSession(session.sessionId!)">
          {{ session.status === 'Completed' ? 'Xem' : 'Äiá»ƒm danh' }}
        </button>
        <button class="btn btn-danger btn-sm" (click)="deleteSession(session)" *ngIf="session.status !== 'Completed'">
          XÃ³a
        </button>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredSessions.length === 0" class="empty-state">
      <p>KhÃ´ng tÃ¬m tháº¥y buá»•i Ä‘iá»ƒm danh nÃ o</p>
    </div>
  </div>

  <!-- Create Session Modal -->
  <div class="modal-overlay" *ngIf="showCreateModal" (click)="closeCreateModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Táº¡o Buá»•i Äiá»ƒm Danh Má»›i</h2>
        <button class="modal-close" (click)="closeCreateModal()">Ã—</button>
      </div>

      <div class="modal-body">
        <form class="session-form">
          <div class="form-group">
            <label>MÃ´n há»c <span class="required">*</span></label>
            <select [(ngModel)]="newSession.courseId" name="courseId" class="form-input" [class.error]="validationErrors.courseId">
              <option value="">Chá»n mÃ´n há»c</option>
              <option *ngFor="let course of courses" [value]="course.courseId">
                {{ course.courseName }}
              </option>
            </select>
            <small class="error-text" *ngIf="validationErrors.courseId">{{ validationErrors.courseId }}</small>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>NgÃ y há»c <span class="required">*</span></label>
              <input type="date" [(ngModel)]="newSession.sessionDate" name="sessionDate" class="form-input" [class.error]="validationErrors.sessionDate" />
              <small class="error-text" *ngIf="validationErrors.sessionDate">{{ validationErrors.sessionDate }}</small>
            </div>

            <div class="form-group">
              <label>Giá» há»c <span class="required">*</span></label>
              <input type="time" [(ngModel)]="newSession.sessionTime" name="sessionTime" class="form-input" [class.error]="validationErrors.sessionTime" />
              <small class="error-text" *ngIf="validationErrors.sessionTime">{{ validationErrors.sessionTime }}</small>
            </div>
          </div>

          <div class="form-group">
            <label>TiÃªu Ä‘á» buá»•i há»c <span class="required">*</span></label>
            <input type="text" [(ngModel)]="newSession.sessionTitle" name="sessionTitle" class="form-input" [class.error]="validationErrors.sessionTitle" placeholder="VD: Buá»•i 1: Giá»›i thiá»‡u mÃ´n há»c" />
            <small class="error-text" *ngIf="validationErrors.sessionTitle">{{ validationErrors.sessionTitle }}</small>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Loáº¡i buá»•i há»c</label>
              <select [(ngModel)]="newSession.sessionType" name="sessionType" class="form-input">
                <option value="LÃ½ thuyáº¿t">LÃ½ thuyáº¿t</option>
                <option value="Thá»±c hÃ nh">Thá»±c hÃ nh</option>
                <option value="Kiá»ƒm tra">Kiá»ƒm tra</option>
              </select>
            </div>

            <div class="form-group">
              <label>Thá»i lÆ°á»£ng (phÃºt)</label>
              <input type="number" [(ngModel)]="newSession.duration" name="duration" class="form-input" min="30" max="180" />
            </div>
          </div>

          <div class="form-group">
            <label>PhÃ²ng há»c</label>
            <input type="text" [(ngModel)]="newSession.location" name="location" class="form-input" placeholder="VD: A101" />
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeCreateModal()">Há»§y</button>
        <button class="btn btn-primary" (click)="createSession()" [disabled]="loading">
          {{ loading ? 'Äang táº¡o...' : 'Táº¡o buá»•i Ä‘iá»ƒm danh' }}
        </button>
      </div>
    </div>
  </div>
</div>
