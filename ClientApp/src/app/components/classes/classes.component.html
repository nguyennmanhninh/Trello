<div class="classes-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <i class="icon">üè´</i>
          Qu·∫£n L√Ω L·ªõp H·ªçc
        </h1>
        <p class="page-subtitle">T·ªïng s·ªë: <strong>{{ totalCount }}</strong> l·ªõp h·ªçc</p>
      </div>
      <div class="action-buttons" *ngIf="canEdit()">
        <button class="btn btn-primary" (click)="openAddModal()">
          <i class="icon">‚ûï</i>
          Th√™m L·ªõp H·ªçc
        </button>
        <button class="btn btn-success" (click)="exportToExcel()" *ngIf="canExport()">
          <i class="icon">üìä</i>
          Xu·∫•t Excel
        </button>
        <button class="btn btn-info" (click)="exportToPdf()" *ngIf="canExport()">
          <i class="icon">üìÑ</i>
          Xu·∫•t PDF
        </button>
      </div>
    </div>
  </div>

  <!-- Search & Filter Section -->
  <div class="toolbar">
    <div class="filters-row">
      <div class="search-box">
        <input 
          type="text" 
          class="search-input"
          [(ngModel)]="searchString"
          (keyup.enter)="onSearch()"
          placeholder="üîç T√¨m ki·∫øm theo m√£ l·ªõp, t√™n l·ªõp..."
        />
        <button class="btn-icon" (click)="onSearch()">
          üîç
        </button>
      </div>
      
      <select 
        class="filter-select"
        [(ngModel)]="selectedDepartmentId"
        (change)="onDepartmentChange()"
      >
        <option value="">-- T·∫•t c·∫£ khoa --</option>
        <option *ngFor="let dept of departments" [value]="dept.departmentId">
          {{ dept.departmentName }}
        </option>
      </select>
    </div>
  </div>

  <!-- Alert Section -->
  <div class="alert-container" *ngIf="showAlert">
    <div class="alert" [ngClass]="'alert-' + alertType">
      <span class="alert-icon">{{ alertType === 'success' ? '‚úÖ' : '‚ùå' }}</span>
      <span class="alert-message">{{ alertMessage }}</span>
      <button class="alert-close" (click)="showAlert = false">√ó</button>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div class="loading-spinner" *ngIf="isLoading && !isModalOpen">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
  </div>

  <!-- Classes Table -->
  <div class="table-container" *ngIf="!isLoading">
    <table class="data-table">
      <thead>
        <tr>
          <th>M√£ L·ªõp</th>
          <th>T√™n L·ªõp</th>
          <th>Khoa</th>
          <th>GVCN</th>
          <th>Sƒ© S·ªë</th>
          <th *ngIf="canEdit() || canDelete()">Thao T√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let class of classes" class="table-row">
          <td class="class-id">{{ class.classId }}</td>
          <td class="class-name">{{ class.className }}</td>
          <td>
            <span class="department-badge">{{ class.departmentName }}</span>
          </td>
          <td>{{ class.teacherName }}</td>
          <td class="text-center">
            <span class="student-count-badge">{{ class.studentCount || 0 }}</span>
          </td>
          <td class="actions" *ngIf="canEdit() || canDelete()">
            <button 
              class="btn-icon btn-edit" 
              (click)="openEditModal(class)"
              *ngIf="canEdit()"
              title="S·ª≠a"
            >
              ‚úèÔ∏è
            </button>
            <button 
              class="btn-icon btn-delete" 
              (click)="confirmDelete(class.classId)"
              *ngIf="canDelete()"
              title="X√≥a"
            >
              üóëÔ∏è
            </button>
          </td>
        </tr>
        <tr *ngIf="classes.length === 0">
          <td [attr.colspan]="canEdit() || canDelete() ? 6 : 5" class="no-data">
            <div class="empty-state">
              <i class="empty-icon">üì≠</i>
              <p>Kh√¥ng c√≥ d·ªØ li·ªáu l·ªõp h·ªçc</p>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="totalPages > 1">
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === 1"
      (click)="onPageChange(1)"
    >
      ‚èÆÔ∏è ƒê·∫ßu
    </button>
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === 1"
      (click)="onPageChange(currentPage - 1)"
    >
      ‚óÄÔ∏è Tr∆∞·ªõc
    </button>
    
    <span class="pagination-info">
      Trang <strong>{{ currentPage }}</strong> / <strong>{{ totalPages }}</strong>
    </span>
    
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === totalPages"
      (click)="onPageChange(currentPage + 1)"
    >
      Sau ‚ñ∂Ô∏è
    </button>
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === totalPages"
      (click)="onPageChange(totalPages)"
    >
      Cu·ªëi ‚è≠Ô∏è
    </button>
  </div>
</div>

<!-- Add/Edit Modal -->
<div class="modal-overlay" *ngIf="isModalOpen" (click)="closeModal()">
  <div class="modal-content modal-small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">
        <i class="icon">{{ isEditMode ? '‚úèÔ∏è' : '‚ûï' }}</i>
        {{ isEditMode ? 'S·ª≠a L·ªõp H·ªçc' : 'Th√™m L·ªõp H·ªçc' }}
      </h2>
      <button class="modal-close" (click)="closeModal()">√ó</button>
    </div>

    <div class="modal-body">
      <form class="class-form">
        <div class="form-grid-single">
          <!-- Class ID -->
          <div class="form-group">
            <label class="form-label required">M√£ L·ªõp</label>
            <input 
              type="text" 
              class="form-input"
              [class.error]="validationErrors.classId"
              [(ngModel)]="currentClass.classId"
              name="classId"
              [disabled]="isEditMode"
              maxlength="10"
              placeholder="Nh·∫≠p m√£ l·ªõp (VD: CL001)"
            />
            <small class="error-text" *ngIf="validationErrors.classId">
              {{ validationErrors.classId }}
            </small>
          </div>

          <!-- Class Name -->
          <div class="form-group">
            <label class="form-label required">T√™n L·ªõp</label>
            <input 
              type="text" 
              class="form-input"
              [class.error]="validationErrors.className"
              [(ngModel)]="currentClass.className"
              name="className"
              maxlength="100"
              placeholder="Nh·∫≠p t√™n l·ªõp (VD: C√¥ng ngh·ªá th√¥ng tin K65)"
            />
            <small class="error-text" *ngIf="validationErrors.className">
              {{ validationErrors.className }}
            </small>
          </div>

          <!-- Department -->
          <div class="form-group">
            <label class="form-label required">Khoa</label>
            <select 
              class="form-input"
              [class.error]="validationErrors.departmentId"
              [(ngModel)]="currentClass.departmentId"
              (change)="onDepartmentChange()"
              name="departmentId"
            >
              <option value="">-- Ch·ªçn khoa --</option>
              <option *ngFor="let dept of departments" [value]="dept.departmentId">
                {{ dept.departmentName }}
              </option>
            </select>
            <small class="error-text" *ngIf="validationErrors.departmentId">
              {{ validationErrors.departmentId }}
            </small>
          </div>

          <!-- Teacher (GVCN) -->
          <div class="form-group">
            <label class="form-label required">Gi√°o Vi√™n Ch·ªß Nhi·ªám</label>
            <select 
              class="form-input"
              [class.error]="validationErrors.teacherId"
              [(ngModel)]="currentClass.teacherId"
              name="teacherId"
              [disabled]="!currentClass.departmentId"
            >
              <option value="">-- Ch·ªçn gi√°o vi√™n --</option>
              <option *ngFor="let teacher of filteredTeachers" [value]="teacher.teacherId">
                {{ teacher.fullName }} ({{ teacher.teacherId }})
              </option>
            </select>
            <small class="error-text" *ngIf="validationErrors.teacherId">
              {{ validationErrors.teacherId }}
            </small>
            <small class="help-text" *ngIf="!currentClass.departmentId">
              Vui l√≤ng ch·ªçn khoa tr∆∞·ªõc
            </small>
          </div>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">
        ‚ùå H·ªßy
      </button>
      <button class="btn btn-primary" (click)="saveClass()" [disabled]="isLoading">
        <span *ngIf="!isLoading">
          <i class="icon">{{ isEditMode ? 'üíæ' : '‚ûï' }}</i>
          {{ isEditMode ? 'C·∫≠p nh·∫≠t' : 'Th√™m m·ªõi' }}
        </span>
        <span *ngIf="isLoading">ƒêang x·ª≠ l√Ω...</span>
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteConfirm" (click)="cancelDelete()">
  <div class="modal-content modal-small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">
        <i class="icon">‚ö†Ô∏è</i>
        X√°c Nh·∫≠n X√≥a
      </h2>
      <button class="modal-close" (click)="cancelDelete()">√ó</button>
    </div>

    <div class="modal-body">
      <p class="confirm-message">
        B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a l·ªõp h·ªçc n√†y kh√¥ng?
      </p>
      <p class="warning-text">
        ‚ö†Ô∏è Thao t√°c n√†y kh√¥ng th·ªÉ ho√†n t√°c!
      </p>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cancelDelete()">
        ‚ùå H·ªßy
      </button>
      <button class="btn btn-danger" (click)="deleteClass()" [disabled]="isLoading">
        <span *ngIf="!isLoading">üóëÔ∏è X√≥a</span>
        <span *ngIf="isLoading">ƒêang x√≥a...</span>
      </button>
    </div>
  </div>
</div>
