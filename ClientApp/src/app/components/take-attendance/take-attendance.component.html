<div class="take-attendance-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Äang táº£i dá»¯ liá»‡u...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-error">
    <span class="alert-icon">âš ï¸</span>
    <span>{{ errorMessage }}</span>
  </div>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="alert alert-success">
    <span class="alert-icon">âœ“</span>
    <span>{{ successMessage }}</span>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading && session" class="content">
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-left">
        <button class="btn-back" (click)="cancel()">
          <span>â†</span> Quay láº¡i
        </button>
        <div class="header-info">
          <h1>Äiá»ƒm Danh: {{ session.sessionTitle }}</h1>
          <p class="session-meta">
            <span class="badge" [class]="getStatusClass(session.status || '')">
              {{ session.status }}
            </span>
            <span>{{ session.courseName }}</span>
            <span>{{ attendanceService.formatDate(session.sessionDate) }}</span>
            <span>{{ attendanceService.formatTime(session.sessionTime) }}</span>
            <span *ngIf="session.location">ğŸ“ {{ session.location }}</span>
          </p>
        </div>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="saveAttendance()" [disabled]="saving">
          <span *ngIf="!saving">ğŸ’¾ LÆ°u</span>
          <span *ngIf="saving">Äang lÆ°u...</span>
        </button>
        <button class="btn btn-primary" (click)="completeSession()" [disabled]="saving">
          <span *ngIf="!saving">âœ“ HoÃ n thÃ nh</span>
          <span *ngIf="saving">Äang xá»­ lÃ½...</span>
        </button>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-info">
          <div class="stat-value">{{ stats.total }}</div>
          <div class="stat-label">Tá»•ng sinh viÃªn</div>
        </div>
      </div>
      <div class="stat-card present">
        <div class="stat-icon">âœ“</div>
        <div class="stat-info">
          <div class="stat-value">{{ stats.present }}</div>
          <div class="stat-label">CÃ³ máº·t</div>
        </div>
      </div>
      <div class="stat-card absent">
        <div class="stat-icon">âœ—</div>
        <div class="stat-info">
          <div class="stat-value">{{ stats.absent }}</div>
          <div class="stat-label">Váº¯ng</div>
        </div>
      </div>
      <div class="stat-card late">
        <div class="stat-icon">â°</div>
        <div class="stat-info">
          <div class="stat-value">{{ stats.late }}</div>
          <div class="stat-label">Muá»™n</div>
        </div>
      </div>
      <div class="stat-card excused">
        <div class="stat-icon">ğŸ“</div>
        <div class="stat-info">
          <div class="stat-value">{{ stats.excused }}</div>
          <div class="stat-label">CÃ³ phÃ©p</div>
        </div>
      </div>
      <div class="stat-card attendance-rate" [style.borderColor]="getAttendanceRateColor()">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-info">
          <div class="stat-value" [style.color]="getAttendanceRateColor()">{{ getAttendanceRate() }}%</div>
          <div class="stat-label">Tá»· lá»‡ Ä‘i há»c</div>
        </div>
      </div>
    </div>

    <!-- Quick Actions & Filters -->
    <div class="toolbar">
      <div class="quick-actions">
        <button class="btn btn-quick" (click)="markAllPresent()">
          âœ“ Táº¥t cáº£ cÃ³ máº·t
        </button>
        <button class="btn btn-quick" (click)="markAllAbsent()">
          âœ— Táº¥t cáº£ váº¯ng
        </button>
      </div>
      <div class="filters">
        <select [(ngModel)]="statusFilter" class="filter-select">
          <option value="All">Táº¥t cáº£ tráº¡ng thÃ¡i</option>
          <option value="Present">CÃ³ máº·t</option>
          <option value="Absent">Váº¯ng</option>
          <option value="Late">Muá»™n</option>
          <option value="Excused">CÃ³ phÃ©p</option>
        </select>
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          placeholder="ğŸ” TÃ¬m MSSV hoáº·c tÃªn..." 
          class="filter-search"
        />
      </div>
    </div>

    <!-- Attendance Table -->
    <div class="attendance-table-container">
      <table class="attendance-table">
        <thead>
          <tr>
            <th class="col-stt">STT</th>
            <th class="col-id">MSSV</th>
            <th class="col-name">Há» vÃ  tÃªn</th>
            <th class="col-status">Tráº¡ng thÃ¡i</th>
            <th class="col-time">Giá» check-in</th>
            <th class="col-notes">Ghi chÃº</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let record of filteredRecords; let i = index" 
              [class.row-present]="record.status === 'Present'"
              [class.row-absent]="record.status === 'Absent'"
              [class.row-late]="record.status === 'Late'"
              [class.row-excused]="record.status === 'Excused'">
            <td class="col-stt">{{ i + 1 }}</td>
            <td class="col-id">{{ record.studentId }}</td>
            <td class="col-name">
              <div class="student-name">{{ record.studentName }}</div>
            </td>
            <td class="col-status">
              <div class="status-buttons">
                <button 
                  class="status-btn present" 
                  [class.active]="record.status === 'Present'"
                  (click)="toggleStatus(record, 'Present')"
                  title="CÃ³ máº·t">
                  âœ“
                </button>
                <button 
                  class="status-btn absent" 
                  [class.active]="record.status === 'Absent'"
                  (click)="toggleStatus(record, 'Absent')"
                  title="Váº¯ng">
                  âœ—
                </button>
                <button 
                  class="status-btn late" 
                  [class.active]="record.status === 'Late'"
                  (click)="toggleStatus(record, 'Late')"
                  title="Muá»™n">
                  â°
                </button>
                <button 
                  class="status-btn excused" 
                  [class.active]="record.status === 'Excused'"
                  (click)="toggleStatus(record, 'Excused')"
                  title="CÃ³ phÃ©p">
                  ğŸ“
                </button>
              </div>
            </td>
            <td class="col-time">
              <input 
                type="time" 
                [(ngModel)]="record.checkInTime" 
                class="time-input"
                [disabled]="record.status === 'Absent'"
                *ngIf="record.status === 'Present' || record.status === 'Late'"
              />
              <span *ngIf="record.status === 'Absent' || record.status === 'Excused'">-</span>
            </td>
            <td class="col-notes">
              <input 
                type="text" 
                [(ngModel)]="record.notes" 
                placeholder="Ghi chÃº..."
                class="notes-input"
                maxlength="200"
              />
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Empty State -->
      <div *ngIf="filteredRecords.length === 0" class="empty-state">
        <p>KhÃ´ng tÃ¬m tháº¥y sinh viÃªn nÃ o</p>
      </div>
    </div>

    <!-- Bottom Actions -->
    <div class="bottom-actions">
      <button class="btn btn-cancel" (click)="cancel()">
        Há»§y
      </button>
      <div class="action-group">
        <button class="btn btn-secondary" (click)="saveAttendance()" [disabled]="saving">
          <span *ngIf="!saving">ğŸ’¾ LÆ°u Ä‘iá»ƒm danh</span>
          <span *ngIf="saving">Äang lÆ°u...</span>
        </button>
        <button class="btn btn-primary" (click)="completeSession()" [disabled]="saving">
          <span *ngIf="!saving">âœ“ HoÃ n thÃ nh & Quay láº¡i</span>
          <span *ngIf="saving">Äang xá»­ lÃ½...</span>
        </button>
      </div>
    </div>
  </div>
</div>
