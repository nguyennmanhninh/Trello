<div class="teachers-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <i class="icon">ğŸ‘¨â€ğŸ«</i>
          Quáº£n LÃ½ GiÃ¡o ViÃªn
        </h1>
        <p class="page-subtitle">Tá»•ng sá»‘: <strong>{{ totalCount }}</strong> giÃ¡o viÃªn</p>
      </div>
      <div class="action-buttons" *ngIf="canEdit()">
        <button class="btn btn-primary" (click)="openAddModal()">
          <i class="icon">â•</i>
          ThÃªm GiÃ¡o ViÃªn
        </button>
        <button class="btn btn-success" (click)="exportToExcel()" *ngIf="canExport()">
          <i class="icon">ğŸ“Š</i>
          Xuáº¥t Excel
        </button>
        <button class="btn btn-info" (click)="exportToPdf()" *ngIf="canExport()">
          <i class="icon">ğŸ“„</i>
          Xuáº¥t PDF
        </button>
      </div>
    </div>
  </div>

  <!-- Search Section -->
  <div class="search-section">
    <div class="search-box">
      <input 
        type="text" 
        class="search-input"
        [(ngModel)]="searchString"
        (keyup.enter)="onSearch()"
        placeholder="ğŸ” TÃ¬m kiáº¿m theo tÃªn, username, sá»‘ Ä‘iá»‡n thoáº¡i..."
      />
      <button class="btn btn-search" (click)="onSearch()">
        TÃ¬m kiáº¿m
      </button>
    </div>
  </div>

  <!-- Alert Section -->
  <div class="alert-container" *ngIf="showAlert">
    <div class="alert" [ngClass]="'alert-' + alertType">
      <span class="alert-icon">{{ alertType === 'success' ? 'âœ…' : 'âŒ' }}</span>
      <span class="alert-message">{{ alertMessage }}</span>
      <button class="alert-close" (click)="showAlert = false">Ã—</button>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div class="loading-spinner" *ngIf="isLoading && !isModalOpen">
    <div class="spinner"></div>
    <p>Äang táº£i dá»¯ liá»‡u...</p>
  </div>

  <!-- Teachers Table -->
  <div class="table-container" *ngIf="!isLoading">
    <table class="data-table">
      <thead>
        <tr>
          <th>MÃ£ GV</th>
          <th>Há» vÃ  TÃªn</th>
          <th>NgÃ y Sinh</th>
          <th>Giá»›i TÃ­nh</th>
          <th>Sá»‘ Äiá»‡n Thoáº¡i</th>
          <th>Äá»‹a Chá»‰</th>
          <th>Khoa</th>
          <th>Username</th>
          <th *ngIf="canEdit() || canDelete()">Thao TÃ¡c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let teacher of teachers" class="table-row">
          <td class="teacher-id">{{ teacher.teacherId }}</td>
          <td class="teacher-name">{{ teacher.fullName }}</td>
          <td>{{ formatDateForDisplay(teacher.dateOfBirth) }}</td>
          <td>
            <span class="gender-badge" [ngClass]="teacher.gender ? 'male' : 'female'">
              {{ teacher.gender ? 'Nam' : 'Ná»¯' }}
            </span>
          </td>
          <td>{{ teacher.phone }}</td>
          <td class="address">{{ teacher.address }}</td>
          <td>
            <span class="department-badge">{{ teacher.departmentName }}</span>
          </td>
          <td>{{ teacher.username }}</td>
          <td class="actions" *ngIf="canEdit() || canDelete()">
            <button 
              class="btn-icon btn-edit" 
              (click)="openEditModal(teacher)"
              *ngIf="canEdit()"
              title="Sá»­a"
            >
              âœï¸
            </button>
            <button 
              class="btn-icon btn-delete" 
              (click)="confirmDelete(teacher.teacherId)"
              *ngIf="canDelete()"
              title="XÃ³a"
            >
              ğŸ—‘ï¸
            </button>
          </td>
        </tr>
        <tr *ngIf="teachers.length === 0">
          <td [attr.colspan]="canEdit() || canDelete() ? 9 : 8" class="no-data">
            <div class="empty-state">
              <i class="empty-icon">ğŸ“­</i>
              <p>KhÃ´ng cÃ³ dá»¯ liá»‡u giÃ¡o viÃªn</p>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="totalPages > 1">
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === 1"
      (click)="onPageChange(1)"
    >
      â®ï¸ Äáº§u
    </button>
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === 1"
      (click)="onPageChange(currentPage - 1)"
    >
      â—€ï¸ TrÆ°á»›c
    </button>
    
    <span class="pagination-info">
      Trang <strong>{{ currentPage }}</strong> / <strong>{{ totalPages }}</strong>
    </span>
    
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === totalPages"
      (click)="onPageChange(currentPage + 1)"
    >
      Sau â–¶ï¸
    </button>
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === totalPages"
      (click)="onPageChange(totalPages)"
    >
      Cuá»‘i â­ï¸
    </button>
  </div>
</div>

<!-- Add/Edit Modal -->
<div class="modal-overlay" *ngIf="isModalOpen" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">
        <i class="icon">{{ isEditMode ? 'âœï¸' : 'â•' }}</i>
        {{ isEditMode ? 'Sá»­a GiÃ¡o ViÃªn' : 'ThÃªm GiÃ¡o ViÃªn' }}
      </h2>
      <button class="modal-close" (click)="closeModal()">Ã—</button>
    </div>

    <div class="modal-body">
      <form class="teacher-form">
        <div class="form-grid">
          <!-- Teacher ID -->
          <div class="form-group">
            <label class="form-label required">MÃ£ GiÃ¡o ViÃªn</label>
            <input 
              type="text" 
              class="form-input"
              [class.error]="validationErrors.teacherId"
              [(ngModel)]="currentTeacher.teacherId"
              name="teacherId"
              [disabled]="isEditMode"
              maxlength="10"
              placeholder="Nháº­p mÃ£ giÃ¡o viÃªn"
            />
            <small class="error-text" *ngIf="validationErrors.teacherId">
              {{ validationErrors.teacherId }}
            </small>
          </div>

          <!-- Full Name -->
          <div class="form-group">
            <label class="form-label required">Há» vÃ  TÃªn</label>
            <input 
              type="text" 
              class="form-input"
              [class.error]="validationErrors.fullName"
              [(ngModel)]="currentTeacher.fullName"
              name="fullName"
              maxlength="100"
              placeholder="Nháº­p há» vÃ  tÃªn"
            />
            <small class="error-text" *ngIf="validationErrors.fullName">
              {{ validationErrors.fullName }}
            </small>
          </div>

          <!-- Date of Birth -->
          <div class="form-group">
            <label class="form-label required">NgÃ y Sinh</label>
            <input 
              type="date" 
              class="form-input"
              [class.error]="validationErrors.dateOfBirth"
              [(ngModel)]="currentTeacher.dateOfBirth"
              name="dateOfBirth"
            />
            <small class="error-text" *ngIf="validationErrors.dateOfBirth">
              {{ validationErrors.dateOfBirth }}
            </small>
          </div>

          <!-- Gender -->
          <div class="form-group">
            <label class="form-label required">Giá»›i TÃ­nh</label>
            <div class="gender-toggle">
              <button 
                type="button"
                class="gender-btn"
                [class.active]="currentTeacher.gender === true"
                (click)="currentTeacher.gender = true"
              >
                ğŸ‘¨ Nam
              </button>
              <button 
                type="button"
                class="gender-btn"
                [class.active]="currentTeacher.gender === false"
                (click)="currentTeacher.gender = false"
              >
                ğŸ‘© Ná»¯
              </button>
            </div>
          </div>

          <!-- Phone -->
          <div class="form-group">
            <label class="form-label required">Sá»‘ Äiá»‡n Thoáº¡i</label>
            <input 
              type="tel" 
              class="form-input"
              [class.error]="validationErrors.phone"
              [(ngModel)]="currentTeacher.phone"
              name="phone"
              maxlength="15"
              placeholder="Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i"
            />
            <small class="error-text" *ngIf="validationErrors.phone">
              {{ validationErrors.phone }}
            </small>
          </div>

          <!-- Address -->
          <div class="form-group">
            <label class="form-label required">Äá»‹a Chá»‰</label>
            <input 
              type="text" 
              class="form-input"
              [class.error]="validationErrors.address"
              [(ngModel)]="currentTeacher.address"
              name="address"
              maxlength="200"
              placeholder="Nháº­p Ä‘á»‹a chá»‰"
            />
            <small class="error-text" *ngIf="validationErrors.address">
              {{ validationErrors.address }}
            </small>
          </div>

          <!-- Department -->
          <div class="form-group">
            <label class="form-label required">Khoa</label>
            <select 
              class="form-input"
              [class.error]="validationErrors.departmentId"
              [(ngModel)]="currentTeacher.departmentId"
              name="departmentId"
            >
              <option value="">-- Chá»n khoa --</option>
              <option *ngFor="let dept of departments" [value]="dept.departmentId">
                {{ dept.departmentName }}
              </option>
            </select>
            <small class="error-text" *ngIf="validationErrors.departmentId">
              {{ validationErrors.departmentId }}
            </small>
          </div>

          <!-- Username -->
          <div class="form-group">
            <label class="form-label required">TÃªn ÄÄƒng Nháº­p</label>
            <input 
              type="text" 
              class="form-input"
              [class.error]="validationErrors.username"
              [(ngModel)]="currentTeacher.username"
              name="username"
              maxlength="50"
              [disabled]="isEditMode"
              placeholder="Nháº­p tÃªn Ä‘Äƒng nháº­p"
            />
            <small class="error-text" *ngIf="validationErrors.username">
              {{ validationErrors.username }}
            </small>
          </div>

          <!-- Password (only for new teachers) -->
          <div class="form-group" *ngIf="!isEditMode">
            <label class="form-label required">Máº­t Kháº©u</label>
            <input 
              type="password" 
              class="form-input"
              [class.error]="validationErrors.password"
              [(ngModel)]="currentTeacher.password"
              name="password"
              maxlength="100"
              placeholder="Nháº­p máº­t kháº©u"
            />
            <small class="error-text" *ngIf="validationErrors.password">
              {{ validationErrors.password }}
            </small>
          </div>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">
        âŒ Há»§y
      </button>
      <button class="btn btn-primary" (click)="saveTeacher()" [disabled]="isLoading">
        <span *ngIf="!isLoading">
          <i class="icon">{{ isEditMode ? 'ğŸ’¾' : 'â•' }}</i>
          {{ isEditMode ? 'Cáº­p nháº­t' : 'ThÃªm má»›i' }}
        </span>
        <span *ngIf="isLoading">Äang xá»­ lÃ½...</span>
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteConfirm" (click)="cancelDelete()">
  <div class="modal-content modal-small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">
        <i class="icon">âš ï¸</i>
        XÃ¡c Nháº­n XÃ³a
      </h2>
      <button class="modal-close" (click)="cancelDelete()">Ã—</button>
    </div>

    <div class="modal-body">
      <p class="confirm-message">
        Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a giÃ¡o viÃªn nÃ y khÃ´ng?
      </p>
      <p class="warning-text">
        âš ï¸ Thao tÃ¡c nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c!
      </p>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cancelDelete()">
        âŒ Há»§y
      </button>
      <button class="btn btn-danger" (click)="deleteTeacher()" [disabled]="isLoading">
        <span *ngIf="!isLoading">ğŸ—‘ï¸ XÃ³a</span>
        <span *ngIf="isLoading">Äang xÃ³a...</span>
      </button>
    </div>
  </div>
</div>
