<div class="courses-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">
      <span class="icon">üìö</span>
      Qu·∫£n L√Ω M√¥n H·ªçc
    </h1>
  </div>

  <!-- Alert Messages -->
  <div *ngIf="successMessage" class="alert alert-success">
    <span class="alert-icon">‚úì</span>
    <span>{{ successMessage }}</span>
  </div>

  <div *ngIf="errorMessage" class="alert alert-error">
    <span class="alert-icon">‚úï</span>
    <span>{{ errorMessage }}</span>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <div class="filters-row">
      <!-- Search Box -->
      <div class="search-box">
        <input 
          type="text" 
          class="search-input" 
          placeholder="T√¨m theo m√£ m√¥n h·ªçc ho·∫∑c t√™n m√¥n h·ªçc..." 
          [(ngModel)]="searchString"
          (keyup.enter)="onSearch()"
        />
        <button class="btn-icon" (click)="onSearch()">
          üîç
        </button>
      </div>

      <!-- Department Filter -->
      <select class="filter-select" [(ngModel)]="selectedDepartmentId" (change)="onDepartmentFilterChange()">
        <option value="">T·∫•t c·∫£ khoa</option>
        <option *ngFor="let dept of departments" [value]="dept.departmentId">
          {{ dept.departmentCode }} - {{ dept.departmentName }}
        </option>
      </select>

      <!-- Teacher Filter -->
      <select class="filter-select" [(ngModel)]="selectedTeacherId" (change)="onTeacherFilterChange()">
        <option value="">T·∫•t c·∫£ gi·∫£ng vi√™n</option>
        <option *ngFor="let teacher of teachers" [value]="teacher.teacherId">
          {{ teacher.fullName }}
        </option>
      </select>
    </div>

    <!-- Action Buttons -->
    <div class="actions-row">
      <button class="btn btn-primary" (click)="openAddModal()" *ngIf="canEdit()">
        <span class="icon">‚ûï</span>
        Th√™m M√¥n H·ªçc
      </button>
      <button class="btn btn-success" (click)="exportToExcel()" *ngIf="canExport()">
        <span class="icon">üìä</span>
        Xu·∫•t Excel
      </button>
      <button class="btn btn-warning" (click)="exportToPdf()" *ngIf="canExport()">
        <span class="icon">üìÑ</span>
        Xu·∫•t PDF
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
  </div>

  <!-- Data Table -->
  <div *ngIf="!isLoading" class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>M√£ M√¥n H·ªçc</th>
          <th>T√™n M√¥n H·ªçc</th>
          <th>S·ªë T√≠n Ch·ªâ</th>
          <th>Khoa</th>
          <th>Gi·∫£ng Vi√™n</th>
          <th class="text-center">Thao T√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="courses.length === 0">
          <td colspan="6" class="empty-state">
            <div class="empty-icon">üìö</div>
            <p>Kh√¥ng t√¨m th·∫•y m√¥n h·ªçc n√†o</p>
          </td>
        </tr>
        <tr *ngFor="let course of courses">
          <td>{{ course.courseId }}</td>
          <td>{{ course.courseName }}</td>
          <td class="text-center">
            <span class="credits-badge">{{ course.credits }}</span>
          </td>
          <td>
            <span class="department-badge">{{ course.departmentName }}</span>
          </td>
          <td>{{ course.teacherName || 'Ch∆∞a ph√¢n c√¥ng' }}</td>
          <td class="text-center">
            <div class="action-buttons">
              <button 
                class="btn-action btn-edit" 
                (click)="openEditModal(course)"
                *ngIf="canEdit()"
                title="S·ª≠a"
              >
                <span class="icon">‚úèÔ∏è</span>
              </button>
              <button 
                class="btn-action btn-delete" 
                (click)="openDeleteModal(course)"
                *ngIf="canDelete()"
                title="X√≥a"
              >
                <span class="icon">üóëÔ∏è</span>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button class="btn-page" (click)="onPageChange(1)" [disabled]="currentPage === 1">
        ‚èÆÔ∏è ƒê·∫ßu
      </button>
      <button class="btn-page" (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1">
        ‚óÄÔ∏è Tr∆∞·ªõc
      </button>
      <span class="page-info">
        Trang <strong>{{ currentPage }}</strong> / <strong>{{ totalPages }}</strong>
        (T·ªïng: <strong>{{ totalCount }}</strong> m√¥n h·ªçc)
      </span>
      <button class="btn-page" (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages">
        Sau ‚ñ∂Ô∏è
      </button>
      <button class="btn-page" (click)="onPageChange(totalPages)" [disabled]="currentPage === totalPages">
        Cu·ªëi ‚è≠Ô∏è
      </button>
    </div>
  </div>
</div>

<!-- Add Course Modal -->
<div class="modal-overlay" *ngIf="showAddModal" (click)="closeAddModal()">
  <div class="modal-content modal-small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">‚ûï Th√™m M√¥n H·ªçc M·ªõi</h2>
      <button class="modal-close" (click)="closeAddModal()">‚úï</button>
    </div>
    
    <div class="modal-body">
      <form class="form-grid-single">
        <!-- Course ID -->
        <div class="form-group">
          <label class="form-label">
            M√£ M√¥n H·ªçc <span class="required">*</span>
          </label>
          <input 
            type="text" 
            class="form-input"
            [class.error]="validationErrors.courseId"
            [(ngModel)]="currentCourse.courseId" 
            name="courseId"
            placeholder="Nh·∫≠p m√£ m√¥n h·ªçc (t·ªëi ƒëa 10 k√Ω t·ª±)"
            maxlength="10"
            required
          />
          <small class="error-text" *ngIf="validationErrors.courseId">
            {{ validationErrors.courseId }}
          </small>
        </div>

        <!-- Course Name -->
        <div class="form-group">
          <label class="form-label">
            T√™n M√¥n H·ªçc <span class="required">*</span>
          </label>
          <input 
            type="text" 
            class="form-input"
            [class.error]="validationErrors.courseName"
            [(ngModel)]="currentCourse.courseName" 
            name="courseName"
            placeholder="Nh·∫≠p t√™n m√¥n h·ªçc"
            maxlength="100"
            required
          />
          <small class="error-text" *ngIf="validationErrors.courseName">
            {{ validationErrors.courseName }}
          </small>
        </div>

        <!-- Credits -->
        <div class="form-group">
          <label class="form-label">
            S·ªë T√≠n Ch·ªâ <span class="required">*</span>
          </label>
          <input 
            type="number" 
            class="form-input"
            [class.error]="validationErrors.credits"
            [(ngModel)]="currentCourse.credits" 
            name="credits"
            placeholder="Nh·∫≠p s·ªë t√≠n ch·ªâ (1-10)"
            min="1"
            max="10"
            required
          />
          <small class="error-text" *ngIf="validationErrors.credits">
            {{ validationErrors.credits }}
          </small>
        </div>

        <!-- Department -->
        <div class="form-group">
          <label class="form-label">
            Khoa <span class="required">*</span>
          </label>
          <select 
            class="form-input"
            [class.error]="validationErrors.departmentId"
            [(ngModel)]="currentCourse.departmentId"
            (change)="onDepartmentChange()"
            name="departmentId"
            required
          >
            <option value="">-- Ch·ªçn khoa --</option>
            <option *ngFor="let dept of departments" [value]="dept.departmentId">
              {{ dept.departmentCode }} - {{ dept.departmentName }}
            </option>
          </select>
          <small class="error-text" *ngIf="validationErrors.departmentId">
            {{ validationErrors.departmentId }}
          </small>
        </div>

        <!-- Teacher (cascading from Department) -->
        <div class="form-group">
          <label class="form-label">
            Gi·∫£ng Vi√™n
          </label>
          <select 
            class="form-input"
            [(ngModel)]="currentCourse.teacherId"
            name="teacherId"
            [disabled]="!currentCourse.departmentId"
          >
            <option value="">-- Ch·ªçn gi·∫£ng vi√™n --</option>
            <option *ngFor="let teacher of filteredTeachers" [value]="teacher.teacherId">
              {{ teacher.teacherId }} - {{ teacher.fullName }}
            </option>
          </select>
          <small class="error-text" *ngIf="!currentCourse.departmentId">
            Vui l√≤ng ch·ªçn khoa tr∆∞·ªõc
          </small>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeAddModal()">
        H·ªßy
      </button>
      <button class="btn btn-primary" (click)="saveCourse()">
        <span class="icon">üíæ</span>
        L∆∞u
      </button>
    </div>
  </div>
</div>

<!-- Edit Course Modal -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
  <div class="modal-content modal-small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">‚úèÔ∏è S·ª≠a M√¥n H·ªçc</h2>
      <button class="modal-close" (click)="closeEditModal()">‚úï</button>
    </div>
    
    <div class="modal-body">
      <form class="form-grid-single">
        <!-- Course ID (disabled) -->
        <div class="form-group">
          <label class="form-label">
            M√£ M√¥n H·ªçc
          </label>
          <input 
            type="text" 
            class="form-input"
            [(ngModel)]="currentCourse.courseId" 
            name="courseId"
            disabled
          />
        </div>

        <!-- Course Name -->
        <div class="form-group">
          <label class="form-label">
            T√™n M√¥n H·ªçc <span class="required">*</span>
          </label>
          <input 
            type="text" 
            class="form-input"
            [class.error]="validationErrors.courseName"
            [(ngModel)]="currentCourse.courseName" 
            name="courseName"
            placeholder="Nh·∫≠p t√™n m√¥n h·ªçc"
            maxlength="100"
            required
          />
          <small class="error-text" *ngIf="validationErrors.courseName">
            {{ validationErrors.courseName }}
          </small>
        </div>

        <!-- Credits -->
        <div class="form-group">
          <label class="form-label">
            S·ªë T√≠n Ch·ªâ <span class="required">*</span>
          </label>
          <input 
            type="number" 
            class="form-input"
            [class.error]="validationErrors.credits"
            [(ngModel)]="currentCourse.credits" 
            name="credits"
            placeholder="Nh·∫≠p s·ªë t√≠n ch·ªâ (1-10)"
            min="1"
            max="10"
            required
          />
          <small class="error-text" *ngIf="validationErrors.credits">
            {{ validationErrors.credits }}
          </small>
        </div>

        <!-- Department -->
        <div class="form-group">
          <label class="form-label">
            Khoa <span class="required">*</span>
          </label>
          <select 
            class="form-input"
            [class.error]="validationErrors.departmentId"
            [(ngModel)]="currentCourse.departmentId"
            (change)="onDepartmentChange()"
            name="departmentId"
            required
          >
            <option value="">-- Ch·ªçn khoa --</option>
            <option *ngFor="let dept of departments" [value]="dept.departmentId">
              {{ dept.departmentCode }} - {{ dept.departmentName }}
            </option>
          </select>
          <small class="error-text" *ngIf="validationErrors.departmentId">
            {{ validationErrors.departmentId }}
          </small>
        </div>

        <!-- Teacher (cascading from Department) -->
        <div class="form-group">
          <label class="form-label">
            Gi·∫£ng Vi√™n
          </label>
          <select 
            class="form-input"
            [(ngModel)]="currentCourse.teacherId"
            name="teacherId"
            [disabled]="!currentCourse.departmentId"
          >
            <option value="">-- Ch·ªçn gi·∫£ng vi√™n --</option>
            <option *ngFor="let teacher of filteredTeachers" [value]="teacher.teacherId">
              {{ teacher.teacherId }} - {{ teacher.fullName }}
            </option>
          </select>
          <small class="error-text" *ngIf="!currentCourse.departmentId">
            Vui l√≤ng ch·ªçn khoa tr∆∞·ªõc
          </small>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeEditModal()">
        H·ªßy
      </button>
      <button class="btn btn-primary" (click)="saveCourse()">
        <span class="icon">üíæ</span>
        C·∫≠p Nh·∫≠t
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
  <div class="modal-content modal-small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">‚ö†Ô∏è X√°c Nh·∫≠n X√≥a</h2>
      <button class="modal-close" (click)="closeDeleteModal()">‚úï</button>
    </div>
    
    <div class="modal-body">
      <div class="confirm-message">
        <div class="confirm-icon">üóëÔ∏è</div>
        <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a m√¥n h·ªçc:</p>
        <p><strong>{{ courseToDelete?.courseId }} - {{ courseToDelete?.courseName }}</strong></p>
        <p class="text-warning">‚ö†Ô∏è H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeDeleteModal()">
        H·ªßy
      </button>
      <button class="btn btn-danger" (click)="deleteCourse()">
        <span class="icon">üóëÔ∏è</span>
        X√≥a
      </button>
    </div>
  </div>
</div>
