<div class="student-attendance-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-spinner">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-error">
    <span class="alert-icon">‚ö†Ô∏è</span>
    <span>{{ errorMessage }}</span>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading" class="content">
    <!-- Page Header -->
    <div class="page-header">
      <h1>üìã ƒêi·ªÉm Danh C·ªßa T√¥i</h1>
      <p class="subtitle">Xem l·ªãch s·ª≠ ƒëi·ªÉm danh v√† th·ªëng k√™ t·ª∑ l·ªá ƒëi h·ªçc</p>
    </div>

    <!-- Overall Statistics Cards -->
    <div class="overall-stats">
      <div class="stat-card total">
        <div class="stat-icon">üìö</div>
        <div class="stat-info">
          <div class="stat-value">{{ overallStats.total }}</div>
          <div class="stat-label">T·ªïng bu·ªïi h·ªçc</div>
        </div>
      </div>
      <div class="stat-card present">
        <div class="stat-icon">‚úì</div>
        <div class="stat-info">
          <div class="stat-value">{{ overallStats.present }}</div>
          <div class="stat-label">C√≥ m·∫∑t</div>
        </div>
      </div>
      <div class="stat-card absent">
        <div class="stat-icon">‚úó</div>
        <div class="stat-info">
          <div class="stat-value">{{ overallStats.absent }}</div>
          <div class="stat-label">V·∫Øng</div>
        </div>
      </div>
      <div class="stat-card late">
        <div class="stat-icon">‚è∞</div>
        <div class="stat-info">
          <div class="stat-value">{{ overallStats.late }}</div>
          <div class="stat-label">Mu·ªôn</div>
        </div>
      </div>
      <div class="stat-card excused">
        <div class="stat-icon">üìù</div>
        <div class="stat-info">
          <div class="stat-value">{{ overallStats.excused }}</div>
          <div class="stat-label">C√≥ ph√©p</div>
        </div>
      </div>
      <div class="stat-card rate" [style.borderColor]="getAttendanceRateColor(overallStats.rate)">
        <div class="stat-icon">üìä</div>
        <div class="stat-info">
          <div class="stat-value" [style.color]="getAttendanceRateColor(overallStats.rate)">{{ overallStats.rate }}%</div>
          <div class="stat-label">T·ª∑ l·ªá ƒëi h·ªçc</div>
        </div>
      </div>
    </div>

    <!-- Warning Alert -->
    <div *ngIf="warnings.length > 0" class="warning-alert">
      <span class="warning-icon">‚ö†Ô∏è</span>
      <div class="warning-content">
        <strong>C·∫£nh b√°o ƒëi·ªÉm danh!</strong>
        <p>B·∫°n c√≥ {{ warnings.length }} m√¥n h·ªçc v·ªõi t·ª∑ l·ªá v·∫Øng cao. Vui l√≤ng ch√∫ √Ω tham gia l·ªõp h·ªçc ƒë·∫ßy ƒë·ªß.</p>
      </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="tabs">
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'records'"
        (click)="switchTab('records')">
        üìã L·ªãch s·ª≠ ƒëi·ªÉm danh
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'statistics'"
        (click)="switchTab('statistics')">
        üìä Th·ªëng k√™ theo m√¥n
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'warnings'"
        (click)="switchTab('warnings')"
        *ngIf="warnings.length > 0">
        ‚ö†Ô∏è C·∫£nh b√°o ({{ warnings.length }})
      </button>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Records Tab -->
      <div *ngIf="activeTab === 'records'" class="records-tab">
        <!-- Filter -->
        <div class="filter-section">
          <label>L·ªçc theo m√¥n h·ªçc:</label>
          <select [(ngModel)]="selectedCourseId" class="filter-select">
            <option value="All">T·∫•t c·∫£ m√¥n h·ªçc</option>
            <option *ngFor="let course of courses" [value]="course.courseId">
              {{ course.courseName }}
            </option>
          </select>
        </div>

        <!-- Records Timeline -->
        <div class="timeline">
          <div *ngFor="let record of filteredRecords" class="timeline-item">
            <div class="timeline-marker" [class]="getStatusClass(record.status)"></div>
            <div class="timeline-content">
              <div class="record-header">
                <div class="record-title">
                  <h3>{{ record.sessionTitle || record.courseName || 'Bu·ªïi h·ªçc' }}</h3>
                  <span class="badge" [class]="getStatusClass(record.status)">
                    {{ getStatusLabel(record.status) }}
                  </span>
                </div>
                <div class="record-date">
                  {{ formatDate(record.sessionDate) }}
                  <span class="time">{{ formatTime(record.sessionTime) }}</span>
                </div>
              </div>
              <div class="record-details">
                <p><strong>M√¥n h·ªçc:</strong> {{ record.courseName || 'Kh√¥ng x√°c ƒë·ªãnh' }}</p>
                <p><strong>ƒê·ªãa ƒëi·ªÉm:</strong> {{ record.location || 'Ch∆∞a x√°c ƒë·ªãnh' }}</p>
                <p *ngIf="record.checkInTime"><strong>Gi·ªù check-in:</strong> {{ record.checkInTime }}</p>
                <p *ngIf="record.notes" class="notes"><strong>Ghi ch√∫:</strong> {{ record.notes }}</p>
              </div>
            </div>
          </div>

          <!-- Empty State -->
          <div *ngIf="filteredRecords.length === 0" class="empty-state">
            <p>Ch∆∞a c√≥ d·ªØ li·ªáu ƒëi·ªÉm danh</p>
          </div>
        </div>
      </div>

      <!-- Statistics Tab -->
      <div *ngIf="activeTab === 'statistics'" class="statistics-tab">
        <div class="statistics-grid">
          <div *ngFor="let stat of statistics" class="stat-course-card">
            <div class="course-header">
              <h3>{{ stat.courseName }}</h3>
              <div class="attendance-rate" [style.color]="getAttendanceRateColor(stat.attendanceRate)">
                {{ stat.attendanceRate }}%
              </div>
            </div>
            <div class="course-stats">
              <div class="stat-row">
                <span class="stat-label">T·ªïng bu·ªïi h·ªçc:</span>
                <span class="stat-value">{{ stat.totalSessions }}</span>
              </div>
              <div class="stat-row present">
                <span class="stat-label">‚úì C√≥ m·∫∑t:</span>
                <span class="stat-value">{{ stat.presentCount }}</span>
              </div>
              <div class="stat-row absent">
                <span class="stat-label">‚úó V·∫Øng:</span>
                <span class="stat-value">{{ stat.absentCount }}</span>
              </div>
              <div class="stat-row late">
                <span class="stat-label">‚è∞ Mu·ªôn:</span>
                <span class="stat-value">{{ stat.lateCount }}</span>
              </div>
              <div class="stat-row excused">
                <span class="stat-label">üìù C√≥ ph√©p:</span>
                <span class="stat-value">{{ stat.excusedCount }}</span>
              </div>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" 
                   [style.width.%]="stat.attendanceRate"
                   [style.backgroundColor]="getAttendanceRateColor(stat.attendanceRate)">
              </div>
            </div>
          </div>

          <!-- Empty State -->
          <div *ngIf="statistics.length === 0" class="empty-state">
            <p>Ch∆∞a c√≥ th·ªëng k√™</p>
          </div>
        </div>
      </div>

      <!-- Warnings Tab -->
      <div *ngIf="activeTab === 'warnings'" class="warnings-tab">
        <div class="warnings-list">
          <div *ngFor="let warning of warnings" class="warning-card">
            <div class="warning-header">
              <span class="warning-icon-large">‚ö†Ô∏è</span>
              <div class="warning-info">
                <h3>C·∫£nh b√°o v·∫Øng nhi·ªÅu</h3>
                <p class="warning-subtitle">T·ª∑ l·ªá v·∫Øng: {{ warning.absentRate }}%</p>
              </div>
            </div>
            <div class="warning-details">
              <div class="detail-row">
                <span class="label">T·ªïng bu·ªïi h·ªçc:</span>
                <span class="value">{{ warning.totalSessions }}</span>
              </div>
              <div class="detail-row">
                <span class="label">S·ªë bu·ªïi v·∫Øng:</span>
                <span class="value danger">{{ warning.absentCount }}</span>
              </div>
            </div>
            <div class="warning-action">
              <p>‚ö†Ô∏è Vui l√≤ng ch√∫ √Ω tham gia l·ªõp h·ªçc ƒë·∫ßy ƒë·ªß ƒë·ªÉ tr√°nh ·∫£nh h∆∞·ªüng ƒë·∫øn k·∫øt qu·∫£ h·ªçc t·∫≠p.</p>
            </div>
          </div>

          <!-- Empty State -->
          <div *ngIf="warnings.length === 0" class="empty-state success">
            <span class="success-icon">‚úì</span>
            <p>Tuy·ªát v·ªùi! B·∫°n kh√¥ng c√≥ c·∫£nh b√°o n√†o.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
