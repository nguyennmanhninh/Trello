<div class="profile-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">
      <span class="icon">üë§</span>
      Th√¥ng Tin C√° Nh√¢n
      <span class="role-badge">{{ userRole }}</span>
    </h1>
  </div>

  <!-- Alert Messages -->
  <div *ngIf="successMessage" class="alert alert-success">
    <span class="alert-icon">‚úì</span>
    <span>{{ successMessage }}</span>
  </div>

  <div *ngIf="errorMessage" class="alert alert-error">
    <span class="alert-icon">‚úï</span>
    <span>{{ errorMessage }}</span>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading && !profileData" class="loading-container">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i th√¥ng tin...</p>
  </div>

  <!-- Profile Content -->
  <div *ngIf="!loading && profileData" class="profile-content">
    
    <!-- STUDENT PROFILE -->
    <div *ngIf="isStudent()" class="profile-card">
      <h2>Th√¥ng tin Sinh vi√™n</h2>
      <div class="profile-info">
        <div class="info-row">
          <label>M√£ sinh vi√™n:</label>
          <span class="value">{{ getStudentData()?.studentId }}</span>
        </div>
        <div class="info-row">
          <label>H·ªç v√† t√™n:</label>
          <span class="value">{{ getStudentData()?.fullName }}</span>
        </div>
        <div class="info-row">
          <label>Email:</label>
          <span class="value">{{ getStudentData()?.email || 'Ch∆∞a c·∫≠p nh·∫≠t' }}</span>
        </div>
        <div class="info-row">
          <label>S·ªë ƒëi·ªán tho·∫°i:</label>
          <span class="value">{{ getStudentData()?.phone || 'Ch∆∞a c·∫≠p nh·∫≠t' }}</span>
        </div>
        <div class="info-row">
          <label>ƒê·ªãa ch·ªâ:</label>
          <span class="value">{{ getStudentData()?.address || 'Ch∆∞a c·∫≠p nh·∫≠t' }}</span>
        </div>
      </div>
      <div class="profile-actions">
        <button class="btn btn-primary" (click)="enableEditMode()">
          Ch·ªânh s·ª≠a
        </button>
        <button class="btn btn-secondary" (click)="openChangePassword()">
          ƒê·ªïi m·∫≠t kh·∫©u
        </button>
      </div>
    </div>

    <!-- TEACHER PROFILE -->
    <div *ngIf="isTeacher()" class="profile-card">
      <h2>Th√¥ng tin Gi·∫£ng vi√™n</h2>
      <div class="profile-info">
        <div class="info-row">
          <label>M√£ gi·∫£ng vi√™n:</label>
          <span class="value">{{ getTeacherData()?.teacherId }}</span>
        </div>
        <div class="info-row">
          <label>H·ªç v√† t√™n:</label>
          <span class="value">{{ getTeacherData()?.fullName }}</span>
        </div>
        <div class="info-row">
          <label>S·ªë ƒëi·ªán tho·∫°i:</label>
          <span class="value">{{ getTeacherData()?.phone || 'Ch∆∞a c·∫≠p nh·∫≠t' }}</span>
        </div>
        <div class="info-row">
          <label>ƒê·ªãa ch·ªâ:</label>
          <span class="value">{{ getTeacherData()?.address || 'Ch∆∞a c·∫≠p nh·∫≠t' }}</span>
        </div>
        <div class="info-row">
          <label>Khoa:</label>
          <span class="value">{{ getTeacherData()?.departmentName || 'Ch∆∞a c√≥' }}</span>
        </div>
      </div>
      <div class="profile-actions">
        <button class="btn btn-primary" (click)="enableEditMode()">
          Ch·ªânh s·ª≠a
        </button>
        <button class="btn btn-secondary" (click)="openChangePassword()">
          ƒê·ªïi m·∫≠t kh·∫©u
        </button>
      </div>
    </div>

    <!-- ADMIN PROFILE -->
    <div *ngIf="isAdmin()" class="profile-card">
      <h2>Th√¥ng tin Qu·∫£n tr·ªã vi√™n</h2>
      <div class="profile-info">
        <div class="info-row">
          <label>T√™n ƒëƒÉng nh·∫≠p:</label>
          <span class="value">{{ getAdminData()?.username }}</span>
        </div>
        <div class="info-row">
          <label>Vai tr√≤:</label>
          <span class="value">{{ getAdminData()?.role }}</span>
        </div>
      </div>
      <div class="profile-actions">
        <button class="btn btn-primary" (click)="enableEditMode()">
          Ch·ªânh s·ª≠a
        </button>
        <button class="btn btn-secondary" (click)="openChangePassword()">
          ƒê·ªïi m·∫≠t kh·∫©u
        </button>
      </div>
    </div>

    <!-- EDIT PROFILE MODAL (Student) -->
    <div class="modal-overlay" *ngIf="isEditMode && isStudent() && editedStudent" (click)="cancelEdit()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Ch·ªânh S·ª≠a Th√¥ng Tin</h2>
          <button class="modal-close" (click)="cancelEdit()">√ó</button>
        </div>
        <div class="modal-body">
          <form class="profile-form">
            <div class="form-group">
              <label>Email</label>
              <input type="email" class="form-input" [(ngModel)]="editedStudent.email" name="email"
                     [class.error]="validationErrors.email" />
              <small class="error-text" *ngIf="validationErrors.email">{{ validationErrors.email }}</small>
            </div>
            <div class="form-group">
              <label>S·ªë ƒëi·ªán tho·∫°i</label>
              <input type="tel" class="form-input" [(ngModel)]="editedStudent.phone" name="phone"
                     [class.error]="validationErrors.phone" />
              <small class="error-text" *ngIf="validationErrors.phone">{{ validationErrors.phone }}</small>
            </div>
            <div class="form-group">
              <label>ƒê·ªãa ch·ªâ</label>
              <textarea class="form-input" [(ngModel)]="editedStudent.address" name="address" rows="3"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="cancelEdit()">H·ªßy</button>
          <button class="btn btn-primary" (click)="saveProfile()">L∆∞u</button>
        </div>
      </div>
    </div>

    <!-- EDIT PROFILE MODAL (Teacher) -->
    <div class="modal-overlay" *ngIf="isEditMode && isTeacher() && editedTeacher" (click)="cancelEdit()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Ch·ªânh S·ª≠a Th√¥ng Tin</h2>
          <button class="modal-close" (click)="cancelEdit()">√ó</button>
        </div>
        <div class="modal-body">
          <form class="profile-form">
            <div class="form-group">
              <label>H·ªç v√† t√™n</label>
              <input type="text" class="form-input" [(ngModel)]="editedTeacher.fullName" name="fullName" 
                     [class.error]="validationErrors.fullName" />
              <small class="error-text" *ngIf="validationErrors.fullName">{{ validationErrors.fullName }}</small>
            </div>
            <div class="form-group">
              <label>S·ªë ƒëi·ªán tho·∫°i</label>
              <input type="tel" class="form-input" [(ngModel)]="editedTeacher.phone" name="phone"
                     [class.error]="validationErrors.phone" />
              <small class="error-text" *ngIf="validationErrors.phone">{{ validationErrors.phone }}</small>
            </div>
            <div class="form-group">
              <label>ƒê·ªãa ch·ªâ</label>
              <textarea class="form-input" [(ngModel)]="editedTeacher.address" name="address" rows="3"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="cancelEdit()">H·ªßy</button>
          <button class="btn btn-primary" (click)="saveProfile()">L∆∞u</button>
        </div>
      </div>
    </div>

    <!-- EDIT PROFILE MODAL (Admin) -->
    <div class="modal-overlay" *ngIf="isEditMode && isAdmin() && editedAdmin" (click)="cancelEdit()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Ch·ªânh S·ª≠a Th√¥ng Tin</h2>
          <button class="modal-close" (click)="cancelEdit()">√ó</button>
        </div>
        <div class="modal-body">
          <form class="profile-form">
            <div class="form-group">
              <label>T√™n ƒëƒÉng nh·∫≠p</label>
              <input type="text" class="form-input" [(ngModel)]="editedAdmin.username" name="username" 
                     [class.error]="validationErrors.username" />
              <small class="error-text" *ngIf="validationErrors.username">{{ validationErrors.username }}</small>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="cancelEdit()">H·ªßy</button>
          <button class="btn btn-primary" (click)="saveProfile()">L∆∞u</button>
        </div>
      </div>
    </div>

    <!-- CHANGE PASSWORD MODAL -->
    <div class="modal-overlay" *ngIf="isChangePasswordMode" (click)="cancelChangePassword()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>ƒê·ªïi M·∫≠t Kh·∫©u</h2>
          <button class="modal-close" (click)="cancelChangePassword()">√ó</button>
        </div>
        <div class="modal-body">
          <form class="password-form">
            <div class="form-group">
              <label>M·∫≠t kh·∫©u c≈© <span class="required">*</span></label>
              <input type="password" class="form-input" [(ngModel)]="passwordData.oldPassword" name="oldPassword"
                     [class.error]="validationErrors.oldPassword" />
              <small class="error-text" *ngIf="validationErrors.oldPassword">{{ validationErrors.oldPassword }}</small>
            </div>
            <div class="form-group">
              <label>M·∫≠t kh·∫©u m·ªõi <span class="required">*</span></label>
              <input type="password" class="form-input" [(ngModel)]="passwordData.newPassword" name="newPassword"
                     [class.error]="validationErrors.newPassword" />
              <small class="error-text" *ngIf="validationErrors.newPassword">{{ validationErrors.newPassword }}</small>
            </div>
            <div class="form-group">
              <label>X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi <span class="required">*</span></label>
              <input type="password" class="form-input" [(ngModel)]="passwordData.confirmPassword" name="confirmPassword"
                     [class.error]="validationErrors.confirmPassword" />
              <small class="error-text" *ngIf="validationErrors.confirmPassword">{{ validationErrors.confirmPassword }}</small>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="cancelChangePassword()">H·ªßy</button>
          <button class="btn btn-primary" (click)="changePassword()">ƒê·ªïi m·∫≠t kh·∫©u</button>
        </div>
      </div>
    </div>

  </div>
</div>
