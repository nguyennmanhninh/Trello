<div class="profile-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">
      <span class="icon">üë§</span>
      Th√¥ng Tin C√° Nh√¢n
      <span class="role-badge" [class.role-admin]="isAdmin()" [class.role-teacher]="isTeacher()" [class.role-student]="isStudent()">
        {{ userRole }}
      </span>
    </h1>
  </div>

  <!-- Alert Messages -->
  <div *ngIf="successMessage" class="alert alert-success">
    <span class="alert-icon">‚úì</span>
    <span>{{ successMessage }}</span>
  </div>

  <div *ngIf="errorMessage" class="alert alert-error">
    <span class="alert-icon">‚úï</span>
    <span>{{ errorMessage }}</span>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading && !profileData" class="loading-container">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i th√¥ng tin...</p>
  </div>

  <!-- Profile Content -->
  <div *ngIf="!loading && profileData" class="profile-content">
    
    <!-- ==================== STUDENT PROFILE ==================== -->
    <div *ngIf="isStudent()" class="student-profile">
      <div *ngIf="!isEditMode" class="profile-view">
        <div class="profile-card">
          <div class="profile-avatar">
            <div class="avatar-circle" [class.male]="getStudentData()?.gender" [class.female]="!getStudentData()?.gender">
              {{ getStudentData()?.fullName?.charAt(0) || 'S' }}
            </div>
          </div>

          <div class="profile-info">
            <div class="info-row">
              <label>M√£ sinh vi√™n:</label>
              <span class="value">{{ getStudentData()?.studentId }}</span>
            </div>
            <div class="info-row">
              <label>H·ªç v√† t√™n:</label>
              <span class="value">{{ getStudentData()?.fullName }}</span>
            </div>
            <div class="info-row">
              <label>Ng√†y sinh:</label>
              <span class="value">{{ formatDate(getStudentData()?.dateOfBirth) }}</span>
            </div>
            <div class="info-row">
              <label>Gi·ªõi t√≠nh:</label>
              <span class="value">{{ getGenderText(getStudentData()?.gender) }}</span>
            </div>
            <div class="info-row">
              <label>Email:</label>
              <span class="value">{{ getStudentData()?.email || 'Ch∆∞a c·∫≠p nh·∫≠t' }}</span>
            </div>
            <div class="info-row">
              <label>S·ªë ƒëi·ªán tho·∫°i:</label>
              <span class="value">{{ getStudentData()?.phone || 'Ch∆∞a c·∫≠p nh·∫≠t' }}</span>
            </div>
            <div class="info-row">
              <label>ƒê·ªãa ch·ªâ:</label>
              <span class="value">{{ getStudentData()?.address || 'Ch∆∞a c·∫≠p nh·∫≠t' }}</span>
            </div>
            <div class="info-row">
              <label>L·ªõp:</label>
              <span class="value">{{ getStudentData()?.className || 'Ch∆∞a c√≥ l·ªõp' }}</span>
            </div>
            <div class="info-row" *ngIf="getStudentData()?.departmentName">
              <label>Khoa:</label>
              <span class="value">{{ getStudentData()?.departmentName }}</span>
            </div>
          </div>

          <div class="profile-actions">
            <button class="btn btn-primary" (click)="enableEditMode()">
              <span class="icon">‚úèÔ∏è</span>
              Ch·ªânh s·ª≠a th√¥ng tin
            </button>
            <button class="btn btn-secondary" (click)="openChangePassword()">
              <span class="icon">üîí</span>
              ƒê·ªïi m·∫≠t kh·∫©u
            </button>
          </div>
        </div>

        <div class="info-note">
          <p><strong>L∆∞u √Ω:</strong> B·∫°n ch·ªâ c√≥ th·ªÉ ch·ªânh s·ª≠a Email, S·ªë ƒëi·ªán tho·∫°i v√† ƒê·ªãa ch·ªâ. 
          ƒê·ªÉ thay ƒë·ªïi c√°c th√¥ng tin kh√°c, vui l√≤ng li√™n h·ªá ph√≤ng ƒê√†o t·∫°o.</p>
        </div>
      </div>

      <!-- Student Edit Mode -->
      <div *ngIf="isEditMode && editedStudent" class="profile-edit">
        <div class="profile-card">
          <h2 class="section-title">Ch·ªânh s·ª≠a th√¥ng tin</h2>
          <form class="profile-form">
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-input" [class.error]="validationErrors.email"
                [(ngModel)]="editedStudent.email" name="email" placeholder="example@email.com" />
              <small class="error-text" *ngIf="validationErrors.email">{{ validationErrors.email }}</small>
            </div>
            <div class="form-group">
              <label class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
              <input type="tel" class="form-input" [class.error]="validationErrors.phone"
                [(ngModel)]="editedStudent.phone" name="phone" placeholder="0123456789" maxlength="11" />
              <small class="error-text" *ngIf="validationErrors.phone">{{ validationErrors.phone }}</small>
            </div>
            <div class="form-group">
              <label class="form-label">ƒê·ªãa ch·ªâ</label>
              <textarea class="form-input" [(ngModel)]="editedStudent.address" name="address" rows="3"
                placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ"></textarea>
            </div>
          </form>
          <div class="profile-actions">
            <button class="btn btn-secondary" (click)="cancelEdit()">H·ªßy</button>
            <button class="btn btn-primary" (click)="saveProfile()" [disabled]="loading">
              <span class="icon">üíæ</span>{{ loading ? 'ƒêang l∆∞u...' : 'L∆∞u thay ƒë·ªïi' }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== TEACHER PROFILE ==================== -->
    <div *ngIf="isTeacher()" class="teacher-profile">
      <div *ngIf="!isEditMode" class="profile-view">
        <div class="profile-card">
          <div class="profile-avatar">
            <div class="avatar-circle teacher" [class.male]="getTeacherData()?.gender" [class.female]="!getTeacherData()?.gender">
              {{ getTeacherData()?.fullName?.charAt(0) || 'T' }}
            </div>
          </div>

          <div class="profile-info">
            <div class="info-row">
              <label>M√£ gi√°o vi√™n:</label>
              <span class="value">{{ getTeacherData()?.teacherId }}</span>
            </div>
            <div class="info-row">
              <label>H·ªç v√† t√™n:</label>
              <span class="value">{{ getTeacherData()?.fullName }}</span>
            </div>
            <div class="info-row">
              <label>Ng√†y sinh:</label>
              <span class="value">{{ formatDate(getTeacherData()?.dateOfBirth) }}</span>
            </div>
            <div class="info-row">
              <label>Gi·ªõi t√≠nh:</label>
              <span class="value">{{ getGenderText(getTeacherData()?.gender) }}</span>
            </div>
            <div class="info-row">
              <label>Email:</label>
              <span class="value">{{ getTeacherData()?.email || 'Ch∆∞a c·∫≠p nh·∫≠t' }}</span>
            </div>
            <div class="info-row">
              <label>S·ªë ƒëi·ªán tho·∫°i:</label>
              <span class="value">{{ getTeacherData()?.phone || 'Ch∆∞a c·∫≠p nh·∫≠t' }}</span>
            </div>
            <div class="info-row">
              <label>ƒê·ªãa ch·ªâ:</label>
              <span class="value">{{ getTeacherData()?.address || 'Ch∆∞a c·∫≠p nh·∫≠t' }}</span>
            </div>
            <div class="info-row" *ngIf="getTeacherData()?.departmentName">
              <label>Khoa:</label>
              <span class="value">{{ getTeacherData()?.departmentName }}</span>
            </div>
          </div>

          <div class="profile-actions">
            <button class="btn btn-primary" (click)="enableEditMode()">
              <span class="icon">‚úèÔ∏è</span>
              Ch·ªânh s·ª≠a th√¥ng tin
            </button>
            <button class="btn btn-secondary" (click)="openChangePassword()">
              <span class="icon">üîí</span>
              ƒê·ªïi m·∫≠t kh·∫©u
            </button>
          </div>
        </div>
      </div>

      <!-- Teacher Edit Mode -->
      <div *ngIf="isEditMode && editedTeacher" class="profile-edit">
        <div class="profile-card">
          <h2 class="section-title">Ch·ªânh s·ª≠a th√¥ng tin</h2>
          <form class="profile-form">
            <div class="form-group">
              <label class="form-label required">H·ªç v√† t√™n</label>
              <input type="text" class="form-input" [class.error]="validationErrors.fullName"
                [(ngModel)]="editedTeacher.fullName" name="fullName" placeholder="Nh·∫≠p h·ªç v√† t√™n" />
              <small class="error-text" *ngIf="validationErrors.fullName">{{ validationErrors.fullName }}</small>
            </div>
            <div class="form-group">
              <label class="form-label">Ng√†y sinh</label>
              <input type="date" class="form-input" [(ngModel)]="editedTeacher.dateOfBirth" name="dateOfBirth" />
            </div>
            <div class="form-group">
              <label class="form-label">Gi·ªõi t√≠nh</label>
              <div class="gender-toggle">
                <button type="button" class="gender-btn" [class.active]="editedTeacher.gender === true"
                  (click)="editedTeacher.gender = true">
                  üë® Nam
                </button>
                <button type="button" class="gender-btn" [class.active]="editedTeacher.gender === false"
                  (click)="editedTeacher.gender = false">
                  üë© N·ªØ
                </button>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-input" [class.error]="validationErrors.email"
                [(ngModel)]="editedTeacher.email" name="email" placeholder="example@email.com" />
              <small class="error-text" *ngIf="validationErrors.email">{{ validationErrors.email }}</small>
            </div>
            <div class="form-group">
              <label class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
              <input type="tel" class="form-input" [class.error]="validationErrors.phone"
                [(ngModel)]="editedTeacher.phone" name="phone" placeholder="0123456789" maxlength="11" />
              <small class="error-text" *ngIf="validationErrors.phone">{{ validationErrors.phone }}</small>
            </div>
            <div class="form-group">
              <label class="form-label">ƒê·ªãa ch·ªâ</label>
              <textarea class="form-input" [(ngModel)]="editedTeacher.address" name="address" rows="3"
                placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ"></textarea>
            </div>
          </form>
          <div class="profile-actions">
            <button class="btn btn-secondary" (click)="cancelEdit()">H·ªßy</button>
            <button class="btn btn-primary" (click)="saveProfile()" [disabled]="loading">
              <span class="icon">üíæ</span>{{ loading ? 'ƒêang l∆∞u...' : 'L∆∞u thay ƒë·ªïi' }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ==================== ADMIN PROFILE ==================== -->
    <div *ngIf="isAdmin()" class="admin-profile">
      <div class="profile-view">
        <div class="profile-card">
          <div class="profile-avatar">
            <div class="avatar-circle admin">
              {{ getAdminData()?.username?.charAt(0)?.toUpperCase() || 'A' }}
            </div>
          </div>

          <div class="profile-info">
            <div class="info-row">
              <label>T√™n ƒëƒÉng nh·∫≠p:</label>
              <span class="value">{{ getAdminData()?.username }}</span>
            </div>
            <div class="info-row">
              <label>Vai tr√≤:</label>
              <span class="value badge-admin">{{ getAdminData()?.role }}</span>
            </div>
          </div>

          <div class="profile-actions">
            <button class="btn btn-secondary" (click)="openChangePassword()">
              <span class="icon">üîí</span>
              ƒê·ªïi m·∫≠t kh·∫©u
            </button>
          </div>
        </div>

        <div class="info-note">
          <p><strong>L∆∞u √Ω:</strong> T√†i kho·∫£n Admin ch·ªâ c√≥ th·ªÉ ƒë·ªïi m·∫≠t kh·∫©u. 
          ƒê·ªÉ thay ƒë·ªïi th√¥ng tin kh√°c, vui l√≤ng li√™n h·ªá qu·∫£n tr·ªã vi√™n c·∫•p cao.</p>
        </div>
      </div>
    </div>

    <!-- ==================== CHANGE PASSWORD MODAL ==================== -->
    <div class="modal-overlay" *ngIf="isChangePasswordMode" (click)="cancelChangePassword()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2 class="modal-title">
            <i class="icon">üîí</i>
            ƒê·ªïi M·∫≠t Kh·∫©u
          </h2>
          <button class="modal-close" (click)="cancelChangePassword()">√ó</button>
        </div>
        
        <div class="modal-body">
          <form class="password-form">
            <div class="form-group">
              <label class="form-label required">M·∫≠t kh·∫©u c≈©</label>
              <input type="password" class="form-input" [class.error]="validationErrors.oldPassword"
                [(ngModel)]="passwordData.oldPassword" name="oldPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u c≈©" />
              <small class="error-text" *ngIf="validationErrors.oldPassword">{{ validationErrors.oldPassword }}</small>
            </div>
            <div class="form-group">
              <label class="form-label required">M·∫≠t kh·∫©u m·ªõi</label>
              <input type="password" class="form-input" [class.error]="validationErrors.newPassword"
                [(ngModel)]="passwordData.newPassword" name="newPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi (t·ªëi thi·ªÉu 6 k√Ω t·ª±)" />
              <small class="error-text" *ngIf="validationErrors.newPassword">{{ validationErrors.newPassword }}</small>
            </div>
            <div class="form-group">
              <label class="form-label required">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
              <input type="password" class="form-input" [class.error]="validationErrors.confirmPassword"
                [(ngModel)]="passwordData.confirmPassword" name="confirmPassword" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi" />
              <small class="error-text" *ngIf="validationErrors.confirmPassword">{{ validationErrors.confirmPassword }}</small>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="cancelChangePassword()">
            <span class="icon">‚úñÔ∏è</span>
            H·ªßy
          </button>
          <button class="btn btn-primary" (click)="changePassword()" [disabled]="loading">
            <span class="icon">üíæ</span>
            {{ loading ? 'ƒêang l∆∞u...' : 'ƒê·ªïi m·∫≠t kh·∫©u' }}
          </button>
        </div>
      </div>
    </div>

  </div>
</div>
