@echo off
chcp 65001 > nul
echo.
echo ??????????????????????????????????????????????????????????
echo ?     ?? DEBUG MODE - STUDENT MANAGEMENT SYSTEM       ?
echo ??????????????????????????????????????????????????????????
echo.

cd StudentManagementSystem

echo [1/4] Cleaning project...
dotnet clean > nul 2>&1

echo [2/4] Building project...
dotnet build > nul 2>&1
if %errorlevel% neq 0 (
    echo.
    echo ? BUILD FAILED!
    echo.
    echo Running verbose build...
    dotnet build
    pause
    exit /b 1
)

echo [3/4] Build successful ?
echo.
echo ??????????????????????????????????????????????????????????
echo ?     DEBUG INSTRUCTIONS         ?
echo ??????????????????????????????????????????????????????????
echo ?    ?
echo ?  1. Wait for app to start    ?
echo ?  2. Browser will open automatically   ?
echo ?  3. Navigate to: https://localhost:5001/Debug         ?
echo ?   ?
echo ?  ?? DEBUG DASHBOARD URL:             ?
echo ?     https://localhost:5001/Debug   ?
echo ? ?
echo ?  ?? RUN TESTS IN ORDER:   ?
echo ?     ? Test 1: Database Connection          ?
echo ?     ? Test 2: Database Queries               ?
echo ?     ? Test 3: Session Status             ?
echo ?     ? Test 4: Login Test (Admin) ? IMPORTANT         ?
echo ?         ?
echo ?  ?? VIEW LOGS:      ?
echo ?     Watch this console for detailed logs              ?
echo ?Look for: "=== LOGIN ATTEMPT ==="            ?
echo ?      ?
echo ?  ?? TEST ACCOUNTS:            ?
echo ?     Admin:   admin / admin123         ?
echo ?     Teacher: gv001 / gv001pass      ?
echo ?     Student: sv001 / sv001pass         ?
echo ?            ?
echo ?  ??  IF TESTS PASS BUT LOGIN FAILS:      ?
echo ? ? Clear browser cookies (F12 ? Application)     ?
echo ?     ? Try Incognito mode (Ctrl+Shift+N)         ?
echo ?     ? Try different browser ?
echo ?        ?
echo ?  ?? TO STOP: Press Ctrl+C         ?
echo ?   ?
echo ??????????????????????????????????????????????????????????
echo.
echo [4/4] Starting application in DEBUG mode...
echo.
echo ????????????????????????????????????????????????????????
echo.

REM Auto-open browser after 3 seconds
start /B timeout /t 3 /nobreak > nul && start https://localhost:5001/Debug

dotnet run --verbosity normal

pause
